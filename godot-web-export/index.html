<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asphalt Rush - Preview</title>
    <style>
        body { margin: 0; background-color: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; color: white; }
        canvas { background-color: #333; border: 2px solid #555; }
        .ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: rgba(0,0,0,0.7); text-align: center; }
        .ui-overlay h1 { font-size: 3em; margin-bottom: 10px; }
        .ui-overlay p { font-size: 1.2em; margin-bottom: 20px; line-height: 1.5; }
        .ui-overlay button { font-size: 1.5em; padding: 10px 20px; cursor: pointer; border: 2px solid #fff; background-color: #222; color: #fff; border-radius: 5px; }
        .ui-overlay button:hover { background-color: #444; }
        #score { position: absolute; top: 20px; left: 20px; font-size: 2em; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="score">Score: 0</div>

    <!-- UI Screens -->
    <div id="startScreen" class="ui-overlay">
        <h1>Asphalt Rush</h1>
        <p>Use W/A/S/D or Arrow Keys to drive.<br>Press Spacebar to jump over cones!<br>(Drifting is available in the full Godot game)</p>
        <button id="startButton">Start Game</button>
    </div>

    <div id="gameOverScreen" class="ui-overlay hidden">
        <h1>Game Over</h1>
        <p id="finalScore">Final Score: 0</p>
        <button id="restartButton">Try Again</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const scoreDisplay = document.getElementById('score');
        const finalScoreDisplay = document.getElementById('finalScore');

        let gameState = 'menu'; // 'menu', 'playing', 'gameOver'
        let score = 0;
        let roadOffset = 0;
        const roadSpeed = 5;

        const player = {
            x: canvas.width / 2,
            y: canvas.height - 100,
            width: 30,
            height: 50,
            speed: 5,
            dx: 0,
            color: '#0095DD',
            isJumping: false,
            canJump: true
        };

        let obstacles = [];
        const keys = {
            ArrowUp: false, w: false,
            ArrowDown: false, s: false,
            ArrowLeft: false, a: false,
            ArrowRight: false, d: false,
            ' ': false
        };

        function createObstacle() {
            const size = 30;
            obstacles.push({
                x: Math.random() * (canvas.width - size),
                y: -size,
                width: size,
                height: size,
                color: '#FFA500'
            });
        }
        
        function jump() {
            if (!player.canJump || player.isJumping) return;
            player.isJumping = true;
            player.canJump = false;
            
            // Jump duration
            setTimeout(() => {
                player.isJumping = false;
            }, 500);

            // Jump cooldown
            setTimeout(() => {
                player.canJump = true;
            }, 1500);
        }

        function handleInput() {
            player.dx = 0;
            if (keys.ArrowLeft || keys.a) player.dx = -player.speed;
            if (keys.ArrowRight || keys.d) player.dx = player.speed;
            if (keys[' ']) jump();
        }

        function update() {
            if (gameState !== 'playing') return;

            handleInput();

            player.x += player.dx;
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            roadOffset = (roadOffset + roadSpeed) % 100;

            obstacles.forEach((obstacle, index) => {
                obstacle.y += roadSpeed;

                // Collision detection (only if not jumping)
                if ( !player.isJumping &&
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y
                ) {
                    endGame();
                }

                if (obstacle.y > canvas.height) {
                    obstacles.splice(index, 1);
                }
            });
            
            score++;
            scoreDisplay.textContent = `Score: ${score}`;
        }

        function drawRoad() {
            ctx.fillStyle = '#444';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 5;
            ctx.setLineDash([20, 30]);
            for (let i = 1; i < 4; i++) {
                ctx.beginPath();
                ctx.moveTo((canvas.width / 4) * i, -100 + roadOffset);
                ctx.lineTo((canvas.width / 4) * i, canvas.height + 100);
                ctx.stroke();
            }
            ctx.setLineDash([]);
        }

        function drawPlayer() {
            ctx.save();
            if (player.isJumping) {
                // Visual effect for jump
                const scale = 1.2;
                ctx.translate(player.x + player.width / 2, player.y + player.height / 2);
                ctx.scale(scale, scale);
                ctx.fillStyle = '#50C8FF'; // Lighter color when jumping
                ctx.fillRect(-player.width / 2, -player.height / 2, player.width, player.height);
            } else {
                ctx.fillStyle = player.color;
                ctx.fillRect(player.x, player.y, player.width, player.height);
            }
            ctx.restore();
        }

        function drawObstacles() {
            obstacles.forEach(obstacle => {
                ctx.fillStyle = obstacle.color;
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawRoad();
            drawPlayer();
            drawObstacles();
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            gameState = 'playing';
            score = 0;
            player.x = canvas.width / 2;
            player.isJumping = false;
            player.canJump = true;
            obstacles = [];
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            scoreDisplay.classList.remove('hidden');
        }

        function endGame() {
            gameState = 'gameOver';
            finalScoreDisplay.textContent = `Final Score: ${score}`;
            gameOverScreen.classList.remove('hidden');
            scoreDisplay.classList.add('hidden');
        }

        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);

        window.addEventListener('keydown', (e) => { if (keys.hasOwnProperty(e.key)) keys[e.key] = true; });
        window.addEventListener('keyup', (e) => { if (keys.hasOwnProperty(e.key)) keys[e.key] = false; });

        setInterval(() => { if (gameState === 'playing') createObstacle(); }, 1000);

        gameLoop();
    </script>
</body>
</html>